<head>
    <title>MaSpeQC</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://kit.fontawesome.com/f77ac44772.js" crossorigin="anonymous"></script> <!--Font Awesome icons-->
    <script src="./javascripts/control.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://d3js.org/d3.v6.js"></script> <!--D3-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./stylesheets/style.css"  />
    <!--CONFIG-->
    <link rel="stylesheet" media="screen" type="text/css" href="./assets/jsgrid.min.css" />
    <link rel="stylesheet" media="screen" type="text/css" href="./assets/jsgrid-theme.min.css" />
    <link rel="stylesheet" href="./assets/style.css">
    <script type="text/javascript" src="./assets/jquery-2.2.4.min.js"></script>
    <script type="text/javascript" src="./assets/jsgrid.min.js"></script>
    <script type="text/javascript" src="./assets/configurationeditor.js"></script>
    <script type="text/javascript">

        // get all machine names from storage for nav bar
        var proteomics = JSON.parse(sessionStorage.getItem("proteomics-machines"));
        var metabolomics = JSON.parse(sessionStorage.getItem("metabolomics-machines"));

        // get caller from controller (main or config)
        let caller = <%-JSON.stringify(type)%>;

        function load_processing() {
            // get configuration file from server (PROTEOMICS)
            fetch("./data/process.json")
                .then((configuration) => {
                    return configuration.json();
                })
                .then((configuration) => {
                    let configurationEditor = ConfigurationEditor.start("Processing",
                        configuration,
                        () => { // callback, when Save button is pressed
                            myconfiguration = configurationEditor.end();
                            console.log(myconfiguration);

                            // create query string
                            var query = new URLSearchParams();
                            query.append("config", JSON.stringify(myconfiguration));
                            query.append("experiment", "Processing");
                            query.append("caller", caller);

                            sessionStorage.setItem("experiment", "processing");
                            
                            // send to server
                            var new_path = "http://" + window.location.hostname + ":" + window.location.port + "/process"
                                + "?" + query.toString();
                            window.location.assign(new_path);
                            

                        }, false, "");
                });

        }

        // DOM loaded callback
		document.addEventListener('DOMContentLoaded', function() {

            // create a tooltip 
            let tooltip = d3.select("body") 
            .append("div")
            .attr("class", "configTooltip")
            .attr("id", "tooltip")
            .style("visibility", "hidden");
            
            if(caller == "main"){
                create_navbar_dropdown();
            }   
            load_processing();
        });

    </script>

</head>